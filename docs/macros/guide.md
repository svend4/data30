# Руководство по использованию макросов

## Назначение

Макросы описывают повторяемые сценарии в стандартизированном формате, чтобы их можно было быстро внедрять, проверять и поддерживать.

## Быстрый старт

1. Выберите шаблон из `templates/macros.yaml`.
2. Скопируйте нужный макрос и заполните параметры.
3. Проверьте соответствие `schemas/macro.schema.json`.
4. Проведите тестовый запуск и обновите блок `reliability`.

## Хранение

- Рекомендуемый формат — **YAML** для удобства чтения и редактирования.
- Валидация выполняется JSON Schema (подходит и для YAML).
- Все обязательные поля должны присутствовать, дополнительные поля запрещены.

## Параметры

Параметры описывают, что можно менять без кода:

- адресатов уведомлений
- пороги (минимальная сумма, критичность)
- шаблоны сообщений
- внешние endpoints
- расписание или событие триггера
- локальные маршрутизации (команды, очереди)
- лимиты и фильтры для выборок

Подставляйте параметры в шагах и условиях как `{{parameter_name}}`.

## Надёжность

Блок `reliability` отражает доверие к макросу.

Рекомендации:

- обновляйте `score` после тестов или инцидентов;
- фиксируйте причины в `basis`;
- отмечайте `failure_rate` и уровень автоматизации.

## Метрики качества

`quality_metrics` фиксирует три ключевые метрики:

- время настройки (минуты),
- стабильность (`low`/`medium`/`high`),
- процент успешных запусков.

## Проверка качества

Перед вводом в эксплуатацию убедитесь:

- Заполнены все обязательные поля.
- `steps` имеют логичную последовательность.
- Все параметры описаны и используются.
- Есть обработка ожидаемых ошибок.

## Частые сценарии

Список готовых шаблонов включает:

- триаж тикетов
- напоминания об оплате
- онбординг сотрудника
- отчеты по метрикам
- публикация контента

Полный список — в `templates/macros.yaml`.

## Каталог MVP-макросов

Уровни зрелости: **MVP** — пригоден для пилота; **Pilot** — проверен на ограниченном объеме; **Stable** — отработан в проде.

| Макрос | Сценарий | Описание | Уровень зрелости |
| --- | --- | --- | --- |
| `support_ticket_triage` | Поддержка | Классификация тикетов и назначение приоритета | Pilot |
| `invoice_reminder` | Биллинг | Напоминания по неоплаченным счетам | Stable |
| `onboarding_checklist` | HR | Создание задач для онбординга | Pilot |
| `weekly_metrics` | Аналитика | Сбор KPI и рассылка отчета | Pilot |
| `incident_status_update` | SRE | Публикация статуса инцидента | Pilot |
| `contract_review` | Legal | Проверка договора по чеклисту | MVP |
| `marketing_brief` | Маркетинг | Сбор и формирование брифа | MVP |
| `knowledge_base_update` | Поддержка | Обновление базы знаний по инциденту | Pilot |
| `sales_lead_enrichment` | Sales | Обогащение лида через API | MVP |
| `shipment_tracking` | Логистика | Проверка доставки и уведомления | Pilot |
| `access_review` | Security | Квартальный пересмотр доступов | Stable |
| `content_publish` | Контент | Проверка и публикация в CMS | Pilot |
| `customer_nps` | Клиентский опыт | Сбор NPS после заказа | Pilot |
| `data_retention_cleanup` | Комплаенс | Очистка данных по политике хранения | Stable |

## Правила добавления и обновления макросов

1. Опишите макрос по структуре Trigger → Steps → Conditions → Errors → Result.
2. Заполните `parameters`, `quality_metrics`, `reliability` и `result`.
3. Проверьте соответствие `schemas/macro.schema.json` (валидация обязательна).
4. При изменении логики увеличьте `version` и обновите метрики качества/надёжности.
5. Проведите тестовый запуск и задокументируйте результаты в `basis`/`signals`.
6. Обновите каталог MVP-макросов и шаблон в `templates/macros.yaml`.
