# data30

Набор материалов для проектирования и документирования макросов.

## Содержимое

- `docs/macros/spec.md` — спецификация формата макроса.
- `docs/macros/guide.md` — руководство по использованию.
- `schemas/macro.schema.json` — схема валидации.
- `templates/macros.yaml` — набор шаблонов макросов.
- `docs/catalog/overview.md` — правила и назначение каталога приложений.
- `docs/catalog/function-mapping.md` — привязка каталога к Function Dictionary.

## Планы и организационные документы

- `plans/plan-raci.md` — роли и RACI-матрица по этапам.
- `plans/plan-dod.md` — план согласования и Definition of Done.
- `plans/plan-roadmap.md` — план работ, оценки длительности и риски.
- `plans/plan-prototype.md` — план прототипирования и ключевые экраны.
- `plans/plan-session.md` — план сессии и рабочие договоренности.
- `plans/plan-timeline.md` — таймлайн проекта и ключевые даты.

## Архив README

- `readmes/README-index.md` — индекс версий README.md из истории репозитория.
## Отзывы и рекомендации

### 1. Разделение оценок
- **Оценка качества**: соответствует ли артефакт заявленным требованиям, работает ли стабильно, корректно ли описан.
- **Оценка полезности**: насколько артефакт помог решить задачу пользователя, сэкономил время или улучшил результат.
- Оценки собираются раздельно, чтобы отличать объективную стабильность от субъективной пользы.

### 2. Привязка отзывов к подтвержденному использованию
- Отзыв можно оставить только после подтвержденного использования (лог события, подтвержденный запуск, отметка в системе).
- Отзыв помечается как **verified** и используется в расчетах рейтинга/рекомендаций.
- Неподтвержденные отзывы сохраняются отдельно и не влияют на итоговые статусы.

### 3. Статус зрелости
Статусы отражают готовность и надежность артефакта:
- **Прототип** — экспериментальный, возможны критические ограничения.
- **Стабильное** — проверен на практике, ограниченное количество дефектов.
- **Рекомендовано** — доказанная надежность и полезность, подтвержденные метриками.

### 4. Механизм модерации и анти-спама
- Автоматическая проверка на дубликаты и спам (повторяющийся текст, подозрительные паттерны).
- Ограничение частоты публикации отзывов от одного пользователя/организации.
- Ручная модерация спорных отзывов и возможность апелляции.
- Репутационные коэффициенты для пользователей с историей подтвержденных отзывов.

### 5. Критерии «рекомендаций» и «лидеров кластера»
- **Рекомендации** присваиваются при выполнении порогов:
  - Минимальное количество подтвержденных отзывов.
  - Средняя оценка качества и полезности выше заданного уровня.
  - Отсутствие критических дефектов за последний период.
- **Лидеры кластера** определяются по сочетанию:
  - Максимальный индекс полезности в своем кластере.
  - Стабильность качества на горизонте времени.
  - Уровень внедрения/использования по подтвержденным данным.
## 1. Структура макроса

**Стандартная структура:** триггер → шаги → условия → ошибки → результат.

- **Триггер** — событие или сигнал, который запускает выполнение.
  - Примеры: входящее письмо, изменение статуса, ручной запуск.
- **Шаги** — упорядоченный набор действий, которые выполняются после триггера.
  - Каждый шаг имеет тип действия и параметры.
- **Условия** — правила, ограничивающие выполнение макроса или отдельных шагов.
  - Примеры: фильтр по полям, проверка контекста, контроль времени.
- **Ошибки** — обработка исключительных ситуаций и политика повторов.
  - Примеры: ретраи, уведомления, альтернативные ветки.
- **Результат** — ожидаемый выход/эффект, статус выполнения и артефакты.
  - Примеры: созданная задача, отправленное уведомление, запись в журнал.

## 2. Единый формат хранения макросов (JSON-шаблон)

```json
{
  "id": "string",
  "name": "string",
  "version": "1.0",
  "description": "string",
  "trigger": {
    "type": "string",
    "params": {}
  },
  "steps": [
    {
      "id": "string",
      "type": "string",
      "params": {},
      "conditions": [
        {
          "type": "string",
          "params": {}
        }
      ],
      "on_error": {
        "strategy": "retry|skip|abort|fallback",
        "retries": 0,
        "fallback_step_id": "string"
      }
    }
  ],
  "conditions": [
    {
      "type": "string",
      "params": {}
    }
  ],
  "errors": {
    "default_strategy": "retry|skip|abort",
    "notify": ["email", "slack", "webhook"],
    "log_level": "info|warn|error"
  },
  "result": {
    "status": "success|partial|failed",
    "outputs": {}
  },
  "metadata": {
    "tags": ["string"],
    "owner": "string",
    "created_at": "ISO-8601",
    "updated_at": "ISO-8601"
  }
}
```

## 3. Базовые макросы (5–10 популярных сценариев)

Ниже — 8 базовых макросов в предложенном JSON-формате (сокращённо, без служебных полей).

### 3.1. Автоответ на входящее письмо
```json
{
  "id": "macro-auto-reply",
  "name": "Автоответ клиенту",
  "trigger": {"type": "email_received", "params": {"mailbox": "support@"}},
  "steps": [
    {"id": "send-reply", "type": "send_email", "params": {"template": "auto_reply"}}
  ],
  "conditions": [{"type": "subject_contains", "params": {"value": "заявка"}}],
  "errors": {"default_strategy": "retry", "notify": ["email"], "log_level": "warn"},
  "result": {"status": "success"}
}
```

### 3.2. Создание задачи из письма
```json
{
  "id": "macro-email-to-task",
  "name": "Письмо → задача",
  "trigger": {"type": "email_received", "params": {"mailbox": "support@"}},
  "steps": [
    {"id": "create-task", "type": "create_task", "params": {"project": "Support"}}
  ],
  "conditions": [{"type": "sender_domain", "params": {"value": "customer.com"}}],
  "errors": {"default_strategy": "retry", "notify": ["slack"], "log_level": "error"},
  "result": {"status": "success"}
}
```

### 3.3. Назначение ответственного при новом тикете
```json
{
  "id": "macro-assign-agent",
  "name": "Автоназначение ответственного",
  "trigger": {"type": "ticket_created", "params": {"queue": "L1"}},
  "steps": [
    {"id": "assign", "type": "assign_user", "params": {"strategy": "round_robin"}}
  ],
  "conditions": [{"type": "priority_in", "params": {"values": ["low", "normal"]}}],
  "errors": {"default_strategy": "skip", "notify": ["slack"], "log_level": "warn"},
  "result": {"status": "success"}
}
```

### 3.4. Эскалация при просрочке SLA
```json
{
  "id": "macro-sla-escalation",
  "name": "Эскалация SLA",
  "trigger": {"type": "sla_breached", "params": {"threshold": "15m"}},
  "steps": [
    {"id": "notify", "type": "notify", "params": {"channel": "slack", "room": "#oncall"}}
  ],
  "conditions": [{"type": "ticket_status", "params": {"value": "open"}}],
  "errors": {"default_strategy": "retry", "notify": ["email"], "log_level": "error"},
  "result": {"status": "success"}
}
```

### 3.5. Обновление статуса по завершению задачи
```json
{
  "id": "macro-close-ticket",
  "name": "Закрытие тикета при решении",
  "trigger": {"type": "task_completed", "params": {"project": "Support"}},
  "steps": [
    {"id": "update", "type": "update_ticket", "params": {"status": "closed"}}
  ],
  "conditions": [{"type": "resolution_code", "params": {"value": "solved"}}],
  "errors": {"default_strategy": "retry", "notify": ["slack"], "log_level": "warn"},
  "result": {"status": "success"}
}
```

### 3.6. Синхронизация контакта с CRM
```json
{
  "id": "macro-crm-sync",
  "name": "Синхронизация контакта",
  "trigger": {"type": "contact_updated", "params": {"source": "support"}},
  "steps": [
    {"id": "sync", "type": "upsert_crm_contact", "params": {"crm": "HubSpot"}}
  ],
  "conditions": [{"type": "field_changed", "params": {"value": "email"}}],
  "errors": {"default_strategy": "retry", "notify": ["email"], "log_level": "error"},
  "result": {"status": "success"}
}
```

### 3.7. Напоминание о необработанном тикете
```json
{
  "id": "macro-idle-reminder",
  "name": "Напоминание о простое",
  "trigger": {"type": "ticket_idle", "params": {"duration": "2h"}},
  "steps": [
    {"id": "remind", "type": "notify", "params": {"channel": "email", "template": "idle_reminder"}}
  ],
  "conditions": [{"type": "assignee_exists", "params": {"value": true}}],
  "errors": {"default_strategy": "skip", "notify": ["email"], "log_level": "warn"},
  "result": {"status": "success"}
}
```

### 3.8. Выставление счета после закрытия
```json
{
  "id": "macro-invoice-on-close",
  "name": "Счет после закрытия",
  "trigger": {"type": "ticket_closed", "params": {"queue": "Billing"}},
  "steps": [
    {"id": "invoice", "type": "create_invoice", "params": {"template": "standard"}}
  ],
  "conditions": [{"type": "tag_contains", "params": {"value": "billable"}}],
  "errors": {"default_strategy": "retry", "notify": ["email"], "log_level": "error"},
  "result": {"status": "success"}
}
```

## 4. Рекомендации по автоматическому подбору макросов

- **Классифицируйте входящие события** по типам (почта, тикеты, CRM, биллинг), чтобы быстро сузить набор подходящих макросов.
- **Используйте веса и теги**: каждому макросу задайте теги и приоритеты. Ранжирование по совпадению тегов и истории успешных срабатываний.
- **Учитывайте контекст**: отдел, роль, время суток, регион, приоритет обращения — это повышает точность подбора.
- **Добавьте «обучение от выбора»**: сохраняйте, какие макросы выбирают сотрудники, и постепенно поднимайте их рейтинг.
- **Фильтруйте по условиям**: сначала отсекайте несовместимые макросы (условия), затем выбирайте лучший по скору.

## 5. Метрики качества макроса

- **Время настройки**
  - Среднее время от создания до первого успешного запуска (минуты/часы).
  - Количество итераций правок до стабильной работы.
- **Надежность**
  - Доля успешных запусков (Success Rate).
  - Частота ошибок по типам (ошибки триггеров, шагов, интеграций).
  - Среднее число ретраев на 1 запуск.
- **Эффективность**
  - Снижение ручных операций (в минутах/задачах).
  - Влияние на SLA (сокращение просрочек).
- **Полезность**
  - Частота использования макроса.
  - Оценка пользователей (CSAT/внутренние оценки).

## Карты бизнес‑сценариев

Полная версия с 10 ключевыми сценариями перенесена в `docs/use-cases/cluster-maps.md`.

## Цель
Метаслой для поиска, интеграции и повторного использования готовых решений.

## Глоссарий: базовые категории функций
- **Ввод данных** — получение данных из форм, API, файлов, веб-скрейпинга, датчиков.
- **Вывод данных** — отображение, экспорт, отправка в сторонние системы.
- **Трансформация** — очистка, нормализация, обогащение, сопоставление, агрегация.
- **Хранение** — базы данных, файлы, облачные хранилища, кэши.
- **Уведомления** — email, мессенджеры, вебхуки, push.
- **Аналитика** — отчёты, дашборды, метрики, прогнозирование.
- **Оркестрация** — очереди, расписания, триггеры, пайплайны.
- **Безопасность** — доступы, аудит, шифрование, комплаенс.

## Минимальный паспорт функции
- **Название**
- **Назначение/описание**
- **Входы** (формат, обязательность, ограничения)
- **Выходы** (формат, гарантии)
- **Условия выполнения** (триггеры, зависимости)
- **Ограничения** (лимиты, квоты, SLA)
- **Цена** (стоимость за запуск/месяц, фримиум)
- **Уровень зрелости** (MVP/бета/прод)
- **Пример использования**

## Примеры
- **WordPress‑плагины**: формы, SEO, кеширование, интеграции CRM.
- **Make.com‑сценарии**: автоматизация заявок, синхронизация таблиц и CRM, рассылки.
- **SaaS‑модули**: биллинг, аналитика, уведомления, авторизация.

## Словник (MVP, 10–20 функций)
1. **Сбор данных из форм** — принимать ввод с сайта и сохранять в таблицу/CRM.
2. **Импорт CSV** — загрузка и валидация табличных данных.
3. **Экспорт CSV/XLSX** — выгрузка данных по фильтрам.
4. **Вебхук‑приёмник** — приём событий от внешних систем.
5. **Вебхук‑отправитель** — отправка событий в внешние сервисы.
6. **Очистка данных** — удаление дублей, нормализация форматов.
7. **Сопоставление сущностей** — связывание контактов/компаний/заказов.
8. **Обогащение данных** — добавление сведений из внешних API.
9. **Планировщик задач** — запуск по расписанию/CRON.
10. **Очередь задач** — асинхронная обработка запросов.
11. **Уведомление email** — шаблоны писем и рассылка.
12. **Уведомление в мессенджер** — Slack/Telegram/Teams.
13. **Хранение файлов** — загрузка и доступ к документам.
14. **Хранение данных** — таблица/БД для сущностей.
15. **Дашборд метрик** — базовая аналитика по событиям.
16. **Отчёт по KPI** — периодическая агрегация и выгрузка.
17. **Авторизация** — логин/SSO/ролевая модель.
18. **Биллинг** — подписки, счета, оплатa.
